





# 学生信息管理系统总结

### 前言

学生信息管理系统是一个练习项目，其主要功能包括：

1. 学生的基本信息管理
2. 老师的基本信息管理
3. 课程的基本信息管理
4. 课程的开课
5. 学生的选课
6. 老师的评分
7. 辅助功能

基于以上目的，对该系统进行开发，主要步骤为：

1. 数据库设计
2. SSM框架搭建
3. 主体项目
4. 项目的打包和部署

### 数据库设计

##### 利用powerdesigner进行数据库设计

 	PowerDesigner是一款非常全面的数据库设计工具。使用PowerDesigner可以快速创建表，支持表与表之间建立关系，界面简洁，功能强大。同时支持将sql脚本导出，多种导出类型任意挑选，简单实用。

 	通过PowerDesigner进行数据库设计时，要注意一下几点：

- 要有主键，且主键自增
- 设置好关联关系，箭头指向的表为父表
- 每个表中只包含该表的固有属性

表结构如下图所示：

![1609314400786](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609314400786.png)



   

​    

 	最后生成相应的sql文件

##### 利用navicat生成数据库结构

###### 连接数据库

 	利用navicat连接数据库时，  mysql 8.0 默认使用 caching_sha2_password 身份验证机制；客户端不支持新的加密方式，需要修改加密方式。

```sh
1：docker exec -it mysql bash
2：mysql -u root -p
3：select host,user,plugin,authentication_string from mysql.user;
4：ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '1937';
5：flush privileges;
```

###### 生成数据库

 	在navicat中新建数据库，常用的数据库类型为：

![1609315009361](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609315009361.png)

 	在新建的数据库中运行powerdesigner中生成的sql文件：

![1609315086307](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609315086307.png)

生成数据库后，要对数据库进行检查，查看是否生成功！

### SSM框架搭建

##### 所依赖的包

pom.xml文件

pom.xml文件是maven项目的主要特征，它的好处很多，在我看来主要有两点

- 自动导入该jar包所依赖的jar
- 直接查询源码

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <!--本项目的坐标，gav，是项目的唯一标识符-->
  <groupId>org.example</groupId>
  <artifactId>student</artifactId>
  <version>1.0-SNAPSHOT</version>
    <!--表明该该项目是war项目，需要借助外部的tomcat才能运行-->
  <packaging>war</packaging>

  <name>student Maven Webapp</name>
  <!-- FIXME change it to the project's website -->
  <url>http://www.example.com</url>

    <!--主要进行版本管理-->
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>1.8</maven.compiler.source>
    <maven.compiler.target>1.8</maven.compiler.target>
    <spring.version>5.2.7.RELEASE</spring.version>
    <jackson.version>2.9.8</jackson.version>
  </properties>
    
    <!--项目所需要的依赖-->
  <dependencies>
      <!--单元测试，可以对方法进行测试，即放入主方法中运行，但该方法不能有参数，不能有返回值-->
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.12</version>
      <scope>test</scope>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-context</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-core</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-beans</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-aop</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-web</artifactId>
      <version>${spring.version}</version>
    </dependency>
    <!--springmvc-->
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-webmvc</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-jdbc</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-tx</artifactId>
      <version>${spring.version}</version>
    </dependency>

    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-test</artifactId>
      <version>${spring.version}</version>
    </dependency>
<!--mybatis-->
    <dependency>
      <groupId>org.mybatis</groupId>
      <artifactId>mybatis</artifactId>
      <version>3.5.5</version>
    </dependency>

    <dependency>
      <groupId>org.mybatis</groupId>
      <artifactId>mybatis-spring</artifactId>
      <version>2.0.5</version>
    </dependency>

    <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>8.0.12</version>
    </dependency>
    <!--<dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>6.0.6</version>
    </dependency>-->

    <dependency>
      <groupId>org.apache.commons</groupId>
      <artifactId>commons-dbcp2</artifactId>
      <version>2.7.0</version>
    </dependency>

    <dependency>
      <groupId>com.github.pagehelper</groupId>
      <artifactId>pagehelper</artifactId>
      <version>5.1.11</version>
    </dependency>


    <!--spring将Map转为json对象的时依赖的两个包-->
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-core</artifactId>
      <version>${jackson.version}</version>
    </dependency>
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-databind</artifactId>
      <version>${jackson.version}</version>
    </dependency>

    <!--添加jsp的支持-->
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>javax.servlet-api</artifactId>
      <version>3.0.1</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>javax.servlet.jsp</groupId>
      <artifactId>jsp-api</artifactId>
      <version>2.1</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>jstl</groupId>
      <artifactId>jstl</artifactId>
      <version>1.2</version>
    </dependency>
    <dependency>
      <groupId>commons-fileupload</groupId>
      <artifactId>commons-fileupload</artifactId>
      <version>1.4</version>
    </dependency>
    <dependency>
      <groupId>commons-io</groupId>
      <artifactId>commons-io</artifactId>
      <version>2.6</version>
    </dependency>
  </dependencies>

  <build>
    <!--将非java文件也打包到目标文件中-->
    <resources>
      <resource>
        <directory>src/main/java</directory>
        <includes>
          <include>**/*.xml</include>
        </includes>
      </resource>
      <resource>
        <directory>src/main/resources</directory>
        <includes>
          <include>**/*.xml</include>
          <include>**/*.properties</include>
        </includes>
      </resource>
    </resources>

    <finalName>student_system</finalName>
  </build>
</project>

```



##### web.xml配置

web.xml是配置文件的入口

```xml
<?xml version="1.0" encoding="UTF-8"?>
 <!--用于代码编写的提示-->
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
          http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1">

    <!--整合spring的几个步骤
    1、配置前端控制器DispatcherServlet 加载Spring-mvc.xml配置文件,还有启动很多东西，加载spring容器
    2、配置Spring上下文监听器：加载applicationContext.xml文件
    3、配置编码过滤器：解决编码问题 -->
    
 <!--加载springmvc-->
    <servlet>
        <servlet-name>student_system</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:spring-mvc.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>

    <servlet-mapping>
        <servlet-name>student_system</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
    
 <!--加载spring-->
    <!--上下文参数-->
    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:applicationContext.xml</param-value>
    </context-param>
    <!--配置spring上下文监听-->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>

    <filter>
        <filter-name>encodingFilter</filter-name>
        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>utf-8</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>encodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>


</web-app>

```



##### 其他配置文件

db.properties, 用于配置数据库的连接信息

```properties
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/student_system?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai&useSSL=false
jdbc.username = root
jdbc.password = Zz19371937
```

applicationContext.xml，用于配置spring，mybatis

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!-- 很全的schema文件 -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/aop
		http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://www.springframework.org/schema/tx
		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context-3.0.xsd">
    <!--加载db.properties-->
    <context:property-placeholder location="classpath:db.properties"></context:property-placeholder>
    <!-- 注解扫描 -->
    <context:component-scan
            base-package="com.sst.service,com.sst.utils"></context:component-scan>


    <!--配置数据源-->
    <bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource">
        <property name="driverClassName" value="${jdbc.driver}"></property>
        <property name="url" value="${jdbc.url}"></property>
        <property name="username" value="${jdbc.username}"></property>
        <property name="password" value="${jdbc.password}"></property>
    </bean>
    <!--获取sqlSessionFactory工厂-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"></property>
        <property name="typeAliasesPackage" value="com.sst.entity"></property>
        <property name="mapperLocations">
            <list>
                <value>
                    classpath:com/sst/mapper/*.xml
                </value>
            </list>
        </property>
        <!--配置分页插件-->
        <property name="plugins">
            <array>
                <bean class="com.github.pagehelper.PageInterceptor">
                    <property name="properties">
                        <value>
                            helperDialect=mysql
                        </value>
                    </property>
                </bean>
            </array>
        </property>
    </bean>

    <!--配置扫描mapper文件-->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.sst.mapper"></property>
        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"></property>
    </bean>
</beans>
```



spring-mvc.xml ,用于配置springmvc

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd">
    <!-- 扫描注解 -->

    <context:component-scan
            base-package="com.sst.controller"></context:component-scan>
    <!-- 注解驱动 -->
    <bean id="conversionService" class="org.springframework.format.support.FormattingConversionServiceFactoryBean" >
        <property name="converters">
            <set >
                <bean class="com.sst.utils.DateConverter"/>
            </set>
        </property>
    </bean>

    <mvc:default-servlet-handler />
    <mvc:annotation-driven conversion-service="conversionService">
        <mvc:message-converters>
            <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
                <property name="objectMapper">
                    <bean class="com.fasterxml.jackson.databind.ObjectMapper">
                        <property name="dateFormat">
                            <bean class="java.text.SimpleDateFormat">
                                <constructor-arg type="java.lang.String" value="yyyy-MM-dd"/>
                            </bean>
                        </property>
                    </bean>
                </property>
            </bean>
        </mvc:message-converters>
    </mvc:annotation-driven>
    <!-- 静态资源 -->
    <mvc:resources location="/js/" mapping="/js/**"></mvc:resources>
    <mvc:resources location="/images/" mapping="/images/**"></mvc:resources>
    <mvc:resources location="/files/" mapping="/files/**"/>
    <!-- 视图解析器 -->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/WEB-INF/page/"/>
        <property name="suffix" value=".jsp"/>
    </bean>

    <!-- Mutipart解析器 -->
    <bean id="multipartResolver"
          class="org.springframework.web.multipart.commons.CommonsMultipartResolver"></bean>

    <!-- 配置拦截器 -->
    <mvc:interceptors>
        <mvc:interceptor>
            <mvc:mapping path="/**/*"/>
            <bean class="com.sst.utils.PathInterceptor"/>
        </mvc:interceptor>

<!--        <mvc:interceptor>-->
<!--            <mvc:mapping path="/**/*"/>-->
<!--            <mvc:exclude-mapping path="/login"/>-->
<!--            <mvc:exclude-mapping path="/logout"/>-->
<!--            <mvc:exclude-mapping path="/captcha/*"/>-->
<!--            <mvc:exclude-mapping path="/static/**"/>-->
<!--            <bean class="com.sst.utils.permissionInterceptor"/>-->
<!--        </mvc:interceptor>-->

    </mvc:interceptors>

</beans>
```

##### 各层文件搭建

###### pojo

pojo文件均继承Entity类，Entity类中的属性是用于实现分页

```java
package com.sst.utils;

public class Entity {
    private Integer  page;
    private Integer limit;

    public Integer getPage() {
        return page;
    }

    public void setPage(Integer page) {
        this.page = page;
    }

    public Integer getLimit() {
        return limit;
    }

    public void setLimit(Integer limit) {
        this.limit = limit;
    }
}

```

```java
package com.sst.entity;

import com.sst.utils.Entity;
import java.util.Date;


/**
 * 
 * @author Sid
 * @time 2020-12-09 08:25:32
 */
public class Section extends Entity{

	private Integer id;

	private Integer year;


	private String type;


	private Integer clazzId;

	private Integer teacherId;


	private Integer courseId;
	private Clazz clazz;
	private  Teacher teacher;
	private  Course course;
	//0表示未选，1表示已选
	private Integer selected = 0;

	public Integer getChecked() {
		return selected;
	}

	public void setChecked(Integer selected) {
		this.selected = selected;
	}

	public Course getCourse() {
		return course;
	}

	public void setCourse(Course course) {
		this.course = course;
	}

	public Clazz getClazz() {
		return clazz;
	}

	public void setClazz(Clazz clazz) {
		this.clazz = clazz;
	}

	public Teacher getTeacher() {
		return teacher;
	}

	public void setTeacher(Teacher teacher) {
		this.teacher = teacher;
	}

	private String remark;

	public Integer getId() {
		return id;
	}
	public void setId(Integer id) {
		this.id = id;
	}
	public Integer getYear() {
		return year;
	}
	public void setYear(Integer year) {
		this.year = year;
	}
	public String getType() {
		return type;
	}
	public void setType(String type) {
		this.type = type;
	}
	public Integer getClazzId() {
		return clazzId;
	}
	public void setClazzId(Integer clazzId) {
		this.clazzId = clazzId;
	}
	public Integer getTeacherId() {
		return teacherId;
	}
	public void setTeacherId(Integer teacherId) {
		this.teacherId = teacherId;
	}
	public Integer getCourseId() {
		return courseId;
	}
	public void setCourseId(Integer courseId) {
		this.courseId = courseId;
	}
	public String getRemark() {
		return remark;
	}
	public void setRemark(String remark) {
		this.remark = remark;
	}

	@Override
	public String toString() {
		return "Section{" +
				"id=" + id +
				", year=" + year +
				", type='" + type + '\'' +
				", clazzId=" + clazzId +
				", teacherId=" + teacherId +
				", courseId=" + courseId +
				", clazz=" + clazz +
				", teacher=" + teacher +
				", course=" + course +
				", remark='" + remark + '\'' +
				'}';
	}
}


```



###### mapper

 	mapper中包含两种文件，mapper接口，和mapper.xml,其中mapper.xml文件内的命名空间为对应接口的全限定路径：

1

```java
package com.sst.mapper;

import java.util.List;
import java.util.Map;

import com.sst.entity.Clazz;

public interface ClazzMapper {

	public int create(Clazz clazz);

	public int delete(Integer id);

	public int update(Clazz clazz);

	public int updateSelective(Clazz clazz);

	public List<Clazz> query(Clazz clazz);


	public Clazz detail(Integer id);

	public int count(Clazz clazz);

}
```

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sst.mapper.ClazzMapper">

	<resultMap type="com.sst.entity.Clazz" id="Clazz">
		<id column="id" property="id"/>
		<result column="clazz_name"  property="clazzName"/>
		<result column="subject_id"  property="subjectId"/>
		<result column="remark"  property="remark"/>
	</resultMap>

	<insert id="create" keyProperty="id" useGeneratedKeys="true" parameterType="com.sst.entity.Clazz">
		insert into tb_clazz(
			clazz_name,
			subject_id,
			remark
		)values(
			#{clazzName},
			#{subjectId},
			#{remark}
		)
	</insert>

	<select id="query" resultMap="Clazz">
		select * from tb_clazz
		<include refid="ClazzFindCriteria"/>
<!--		<if test="offset!=null and rows!=null">limit ${offset} , ${rows}</if>-->
	</select>


	<select id="count" resultType="int">
		select count(1) from tb_clazz
		<include refid="ClazzFindCriteria"/>
	</select>

	<select id="detail" resultMap="Clazz">
		select * from tb_clazz where id = #{id}
	</select>

	<delete id="delete">
		delete from tb_clazz where id = #{id}
	</delete>
	<update id="update">
		update tb_clazz set
			clazz_name=#{clazzName},
			subject_id=#{subjectId},
			remark=#{remark}
		where id = #{id}
	</update>

	<update id="updateSelective">
		update tb_clazz set
			<if test="clazzName != null and clazzName != ''"> clazz_name = #{clazzName}</if>,
			<if test="subjectId != null">subject_id = #{subjectId}</if>,
			<if test="remark != null and remark != ''"> remark = #{remark}</if>
		where id = #{id}
	</update>

	<sql id="ClazzFindCriteria">
		<where>
			<if test="id != null">and id = #{id}</if>
			<if test="clazzName != null and clazzName != ''">and clazz_name = #{clazzName}</if>
			<if test="subjectId != null">and subject_id = #{subjectId}</if>
			<if test="remark != null and remark != ''">and remark = #{remark}</if>
		</where>
	</sql>

</mapper>
```



###### service

 	service包中一般包含service接口和service实现类，本项目只采用了service实现类

```java
package com.sst.service;

import com.sst.entity.Student;

import javax.annotation.Resource;

import com.sst.mapper.ClazzMapper;
import com.sst.mapper.StudentMapper;
import com.sst.utils.PageHelperUtils;
import org.springframework.stereotype.Service;
import java.util.List;

@Service
public class StudentService {

    @Resource
    private StudentMapper studentMapper;
    @Resource
    private ClazzMapper clazzMapper;

    public int create(Student student) {
        return studentMapper.create(student);
    }

    public int delete(String ibs) {
        String[] strings = ibs.split(",");
        int flag = 0;
        for (String id:strings) {
            flag = studentMapper.delete(Integer.parseInt(id));
        }
        return flag;
    }

    public int update(Student student) {
        return studentMapper.update(student);
    }

    public int updateSelective(Student student) {
        return studentMapper.updateSelective(student);
    }

    public List<Student> query(Student student) {
        return studentMapper.query(student);
    }

    public List<Student> queryByTeacher(Student student) {
        PageHelperUtils.pageHelper(student);
        List<Student> students = studentMapper.queryByTeacher(student);
        students.forEach(student1 -> {
            student1.setClazz(clazzMapper.detail(student1.getClazzId()));
        });
        return students;
    }

    public Student detail(Integer id) {
        Student student = new Student();
        student.setId(id);
        return studentMapper.login(student);
    }

    public Student login(Student student) {
        return studentMapper.login(student);
    }

    public int count(Student student) {
        return studentMapper.count(student);
    }
}

```



###### controller

controller包含各个表的控制和各个功能的实现，是内容最丰富的包

```java
package com.sst.controller;

import com.sst.entity.Clazz;
import com.sst.entity.Student;
import com.sst.entity.Subject;
import com.sst.service.ClazzService;
import com.sst.service.StudentService;
import com.sst.service.SubjectService;
import com.sst.utils.MD5Utils;
import com.sst.utils.MapControl;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import java.util.List;
import java.util.Map;

@Controller
@RequestMapping("/student")
public class StudentController {

    private static final String LIST = "student/list";
    private static final String ADD = "student/add";
    private static final String UPDATE = "student/update";

    @Resource
    private StudentService studentService;
    @Resource
    private ClazzService clazzService;
    @Resource
    private SubjectService subjectService;

    @PostMapping("/create")
    @ResponseBody
    public Map<String, Object> create(@RequestBody Student student){
        student.setStuPwd(MD5Utils.getMD5(student.getStuPwd()));
        int result = studentService.create(student);
        if (result <= 0){
            return MapControl.getInstance().error().getMap();
        }
        return MapControl.getInstance().success().getMap();
    }

    @PostMapping("/delete")
    @ResponseBody
    public Map<String, Object> delete(String ids){
        int result = studentService.delete(ids);
        if (result <= 0){
            return MapControl.getInstance().error().getMap();
        }
        return MapControl.getInstance().success().getMap();
    }


    @PostMapping("/update")
    @ResponseBody
    public Map<String, Object> update(@RequestBody Student student){
        int result = studentService.update(student);
        if (result <= 0){
            return MapControl.getInstance().error().getMap();
        }
        return MapControl.getInstance().success().getMap();
    }

    @GetMapping("/detail/{id}")
    public String detail(@PathVariable("id") Integer id,ModelMap modelMap){
        List<Clazz> clazzes = clazzService.query(null);
        Student student = studentService.detail(id);
        List<Subject> subjects = subjectService.query(null);
        modelMap.addAttribute("student", student);
        modelMap.addAttribute("clazzes",clazzes);
        modelMap.addAttribute("subjects",subjects);

       return UPDATE;
    }

    @PostMapping("/query")
    @ResponseBody
    public Map<String, Object> query(@RequestBody Student student, ModelMap modelMap){

        List<Student> list = studentService.query(student);
        List<Clazz> clazzes = clazzService.query(null);
        List<Subject> subjects = subjectService.query(null);
        //将班级和专业列表放入session
        modelMap.addAttribute("clazzes",clazzes);
        modelMap.addAttribute("subjects",subjects);

        //匹配班级 ,匹配专业
        list.forEach(student1 -> {
            clazzes.forEach(clazz -> {
                if (student1.getClazzId() == clazz.getId()){
                    student1.setClazz(clazz);
                }
            });
            subjects.forEach(subject -> {
                if (student1.getSubjectId() == subject.getId()){
                    student1.setSubject(subject);
                }
            });
        });


        int count = studentService.count(student);
        return  MapControl.getInstance().success().add("data",list).add("count",count).getMap();
    }

    @GetMapping("/list")
    public String list(ModelMap modelMap){
        List<Clazz> clazzes = clazzService.query(null);
        List<Subject> subjects = subjectService.query(null);
        modelMap.addAttribute("clazzes",clazzes);
        modelMap.addAttribute("subjects",subjects);
        return LIST;
    }
    @GetMapping("/add")
    public String add(ModelMap modelMap){
        List<Clazz> clazzes = clazzService.query(null);
        List<Subject> subjects = subjectService.query(null);
        modelMap.addAttribute("clazzes",clazzes);
        modelMap.addAttribute("subjects",subjects);
        return ADD;
    }

    @GetMapping("listByTeacher")
    public String listByTeacher(){
        return "student/listByTeacher";
    }

    @PostMapping("queryByTeacher")
    @ResponseBody
    public Map<String, Object> queryByTeacher(@RequestBody Student student){
        String clazzName = student.getClazzName();
        if(clazzName!=null&&clazzName.length()!=0){
            List<Clazz> clazzes = clazzService.query(null);
            clazzes.forEach(clazz -> {
                if (clazzName.equals(clazz.getClazzName())){
                    student.setClazzId(clazz.getId());
                }
            });
        }

        List<Student> students = studentService.queryByTeacher(student);
        int count = students.size();

        return MapControl.getInstance().success().add("count",count).add("data",students).getMap();
    }
}

```

```java
package com.sst.controller;

import com.sst.entity.Student;
import com.sst.entity.Teacher;
import com.sst.entity.User;
import com.sst.service.StudentService;
import com.sst.service.TeacherService;
import com.sst.service.UserService;
import com.sst.utils.MD5Utils;
import com.sst.utils.MapControl;
import org.springframework.stereotype.Controller;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.annotation.Resource;
import javax.servlet.http.HttpSession;
import java.util.Map;

@Controller
public class LoginController {
    @Resource
    private UserService userService;
    @Resource
    private TeacherService teacherService;
    @Resource
    private StudentService studentService;

    @GetMapping("/login")
    public String login(){
        System.out.println("login控制器");
        return "login";
    }

    @PostMapping("/login")
    @ResponseBody
    public Map<String,Object> login(String username, String password, String type, String captcha, HttpSession session){
        if (StringUtils.isEmpty(username)||StringUtils.isEmpty(username)||StringUtils.isEmpty(username)||StringUtils.isEmpty(username)){
            return MapControl.getInstance().error("数据不能为空").getMap();
        }


        if (!captcha.equalsIgnoreCase((String) session.getAttribute("captcha"))){
            return MapControl.getInstance().error("验证码错误").getMap();
        }
        password = MD5Utils.getMD5(password);
        //管理员登录
        if ("1".equals(type)){
            User user = new User();
            user.setUserName(username);
            user.setUserPwd(password);
            User userData = userService.login(user);
            if (userData != null){
                session.setAttribute("user",userData);
                session.setAttribute("type",1);
                System.out.println("管理员登录");

                return MapControl.getInstance().success().add("type",1).getMap();
            }else {
                return MapControl.getInstance().loginError().getMap();
            }
        }
        //老师登录
        if ("2".equals(type)){
            Teacher teacher = new Teacher();
            teacher.setTeacherName(username);
            teacher.setTeacherPwd(password);
            Teacher teacherData = teacherService.login(teacher);
            if (teacherData != null){
                session.setAttribute("user",teacherData);
                session.setAttribute("type",2);
                System.out.println("老师登录");
                return MapControl.getInstance().success().add("type",2).getMap();
            }else {
                return MapControl.getInstance().loginError().getMap();
            }

        }
        //学生登录
        if ("3".equals(type)){
            Student student = new Student();
            student.setStuName(username);
            student.setStuPwd(password);
            System.out.println("userName:"+username);
            System.out.println("password:"+password);
            Student studentData = studentService.login(student);
            if (studentData != null){
                session.setAttribute("user",studentData);
                session.setAttribute("type",3);
                System.out.println("学生登录");
                return MapControl.getInstance().success().add("type",3).getMap();
            }else {
                return MapControl.getInstance().loginError().getMap();
            }

        }

        return MapControl.getInstance().error().getMap();
    }


}

```



###### utils

utils是工具类包，包含各种工具，如：

- 将类转换为map

- 操作状态码

- 日期类型转换（从前端得到的字符串）

- 用于分页的实体类

- 全局错误通知

- 生成json字符串

- MD5加密

- 分页工具类

- 拦截器（生成完整路径）

- 拦截器（拦截非法访问）

- 定义非法访问异常

  

##### 整合layui框架

核心包放到static文件夹中，页面放置在WEB-INF/page中

![1609334344595](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609334344595.png)



### 主体项目设计

##### 登录功能

登录页面

```jsp
<%--
  Created by IntelliJ IDEA.
  User: lenovo
  Date: 2020/12/9
  Time: 23:04
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"  %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>学生信息管理系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="${basePath}static/lib/layui-v2.5.5/css/layui.css" media="all">
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        html, body {width: 100%;height: 100%;overflow: hidden}
        body {background: #1E9FFF;}
        body:after {content:'';background-repeat:no-repeat;background-size:cover;-webkit-filter:blur(3px);-moz-filter:blur(3px);-o-filter:blur(3px);-ms-filter:blur(3px);filter:blur(3px);position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;}
        .layui-container {width: 100%;height: 100%;overflow: hidden}
        .admin-login-background {width:360px;height:300px;position:absolute;left:50%;top:40%;margin-left:-180px;margin-top:-100px;}
        .logo-title {text-align:center;letter-spacing:2px;padding:14px 0;}
        .logo-title h1 {color:#1E9FFF;font-size:25px;font-weight:bold;}
        .login-form {background-color:#fff;border:1px solid #fff;border-radius:3px;padding:14px 20px;box-shadow:0 0 8px #eeeeee;}
        .login-form .layui-form-item {position:relative;}
        .login-form .layui-form-item label {position:absolute;left:1px;top:1px;width:38px;line-height:36px;text-align:center;color:#d2d2d2;}
        .login-form .layui-form-item input {padding-left:36px;}
        .captcha {width:60%;display:inline-block;}
        .captcha-img {display:inline-block;width:34%;float:right;}
        .captcha-img img {height:34px;border:1px solid #e6e6e6;height:36px;width:100%;}
    </style>
</head>
<body>
<div class="layui-container">
    <div class="admin-login-background">
        <div class="layui-form login-form">
            <form class="layui-form" action="">
                <div class="layui-form-item logo-title">
                    <h1>学生信息管理系统</h1>
                </div>
                <div class="layui-form-item">
                    <label class="layui-icon layui-icon-username" ></label>
                    <input type="text" name="username" lay-verify="required|account" placeholder="用户名或者邮箱" autocomplete="off" class="layui-input"  value="admin">
                </div>
                <div class="layui-form-item">
                    <label class="layui-icon layui-icon-password" ></label>
                    <input type="password" name="password" lay-verify="required|password" placeholder="密码" autocomplete="off" class="layui-input" value="123123">
                </div>
                <div class="layui-form-item">
                    <label class="layui-icon layui-icon-username"></label>
                    <select name="type" lay-verify="required">
                        <option value="">请选择用户类型</option>
                        <option value="1" selected>管理员</option>
                        <option value="2">老师</option>
                        <option value="3">学生</option>
                    </select>
                </div>
                <div class="layui-form-item" >
                    <label class="layui-icon layui-icon-vercode" ></label>
                    <input type="text" name="captcha" lay-verify="required|captcha" placeholder="图形验证码" autocomplete="off"style="width: 150px" class="layui-input verification captcha"  >
                    <div class="captcha-img" >
                        <img type="image" src="${basePath}captcha/code" id="captchaImg" style="cursor:pointer;margin-left: 0px;"/>
                    </div>

                </div>
                <div class="layui-form-item">
                    <input type="checkbox" name="rememberMe" value="true" lay-skin="primary" title="记住密码">
                </div>
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn layui-btn-normal layui-btn-fluid" lay-submit="" lay-filter="login">登 入</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="${basePath}static/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="${basePath}static/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="${basePath}static/lib/jq-module/jquery.particleground.min.js" charset="utf-8"></script>
<script>
    layui.use(['form','jquery'], function () {
        var form = layui.form,
            $ = layui.jquery,
            layer = layui.layer;

        // 登录过期的时候，跳出ifram框架
        if (top.location != self.location) top.location = self.location;
        //点击验证码
        $('#captchaImg').click(function(){
            $(this).attr("src","captcha/code?"+Math.random())
        });

        // 粒子线条背景
        $(document).ready(function(){
            $('.layui-container').particleground({
                dotColor:'#7ec7fd',
                lineColor:'#7ec7fd'
            });
        });


        // 进行登录操作
        form.on('submit(login)', function (data) {
            $.ajax({
                url:"${basePath}login",
                type:"POST",
                dataType:'json',
                data:data.field,
                success:function(data){
                    if(data.code == "0"){
                        if (data.type=="1"){location.href = "userIndex";}
                        if (data.type=="2"){location.href = "teacherIndex";}
                        if (data.type=="3"){location.href = "studentIndex";}
                    }else{
                        layer.msg(data.msg,{time:2000});
                    }
                }
            });
            return false;
        });
    });
</script>
</body>
</html>

```

核心页面

```jsp
<%--
  Created by IntelliJ IDEA.
  User: lenovo
  Date: 2020/12/9
  Time: 23:04
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"  %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>学生管理系统</title>
    <meta name="keywords" content="layuimini,layui,layui模板,layui后台,后台模板,admin,admin模板,layui mini">
    <meta name="description" content="layuimini基于layui的轻量级前端后台管理框架，最简洁、易用的后台框架模板，面向所有层次的前后端程序,只需提供一个接口就直接初始化整个框架，无需复杂操作。">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" href="${basePath}static/images/favicon.ico">
    <link rel="stylesheet" href="${basePath}static/lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="${basePath}static/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="${basePath}static/css/layuimini.css?v=2.0.1" media="all">
    <link rel="stylesheet" href="${basePath}static/css/themes/default.css" media="all">
    <link rel="stylesheet" href="${basePath}static/css/public.css" media="all">
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style id="layuimini-bg-color">
    </style>
</head>
<body class="layui-layout-body layuimini-all">
<div class="layui-layout layui-layout-admin">

    <div class="layui-header header">
        <div class="layui-logo layuimini-logo layuimini-back-home"></div>

        <div class="layuimini-header-content">
            <a>
                <div class="layuimini-tool"><i title="展开" class="fa fa-outdent" data-side-fold="1"></i></div>
            </a>

            <!--电脑端头部菜单-->
            <ul class="layui-nav layui-layout-left layuimini-header-menu layuimini-menu-header-pc layuimini-pc-show">
            </ul>

            <!--手机端头部菜单-->
            <ul class="layui-nav layui-layout-left layuimini-header-menu layuimini-mobile-show">
                <li class="layui-nav-item">
                    <a href="javascript:;"><i class="fa fa-list-ul"></i> 选择模块</a>
                    <dl class="layui-nav-child layuimini-menu-header-mobile">
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-layout-right">

                <li class="layui-nav-item" lay-unselect>
                    <a href="javascript:;" data-refresh="刷新"><i class="fa fa-refresh"></i></a>
                </li>
                <%--                <li class="layui-nav-item" lay-unselect>--%>
                <%--                    <a href="javascript:;" data-clear="清理" class="layuimini-clear"><i class="fa fa-trash-o"></i></a>--%>
                <%--                </li>--%>
                <li class="layui-nav-item mobile layui-hide-xs" lay-unselect>
                    <a href="javascript:;" data-check-screen="full"><i class="fa fa-arrows-alt"></i></a>
                </li>
                <li class="layui-nav-item layuimini-setting">
                    <a href="javascript:;">
                        <c:if test="${type ==1}">${user.userName}</c:if>
                        <c:if test="${type ==2}">${user.teacherName}</c:if>
                        <c:if test="${type ==3}">${user.stuName}</c:if>
                    </a>
                    <dl class="layui-nav-child">
                        <dd>
                            <a href="javascript:;" layuimini-content-href="page/user-setting.html" data-title="基本资料" data-icon="fa fa-gears">基本资料<span class="layui-badge-dot"></span></a>
                        </dd>
                        <dd>
                            <a href="javascript:;" layuimini-content-href="page/user-password.html" data-title="修改密码" data-icon="fa fa-gears">修改密码</a>
                        </dd>
                        <dd>
                            <hr>
                        </dd>
                        <dd>
                            <a href="javascript:;" class="login-out">退出登录</a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item layuimini-select-bgcolor" lay-unselect>
                    <a href="javascript:;" data-bgcolor="配色方案"><i class="fa fa-ellipsis-v"></i></a>
                </li>
            </ul>
        </div>
    </div>

    <!--无限极左侧菜单-->
    <div class="layui-side layui-bg-black layuimini-menu-left">
    </div>

    <!--初始化加载层-->
    <div class="layuimini-loader">
        <div class="layuimini-loader-inner"></div>
    </div>

    <!--手机端遮罩层-->
    <div class="layuimini-make"></div>

    <!-- 移动导航 -->
    <div class="layuimini-site-mobile"><i class="layui-icon"></i></div>

    <div class="layui-body">

        <div class="layui-card layuimini-page-header layui-hide">
            <div class="layui-breadcrumb layuimini-page-title">
                <a lay-href="" href="/">主页</a><span lay-separator="">/</span>
                <a><cite>常规管理</cite></a><span lay-separator="">/</span>
                <a><cite>系统设置</cite></a>
            </div>
        </div>

        <div class="layuimini-content-page">
        </div>

    </div>

</div>
<script src="${basePath}static/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="${basePath}static/js/lay-config.js?v=2.0.0" charset="utf-8"></script>
<script>
    layui.use(['jquery', 'layer', 'miniAdmin', 'miniTongji'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            miniAdmin = layui.miniAdmin,
            miniTongji = layui.miniTongji;

        var options = {
            iniUrl: "${basePath}static/api/userInit.json",    // 初始化接口
            clearUrl: "${basePath}static/api/clear.json", // 缓存清理接口
            renderPageVersion: true,    // 初始化页面是否加版本号
            bgColorDefault: 3,      // 主题默认配置
            loginType:2,      //默认登录权限
            multiModule: true,          // 是否开启多模块
            menuChildOpen: false,       // 是否默认展开菜单
            loadingTime: 0,             // 初始化加载时间
            pageAnim: false,             // 切换菜单动画
        };
        miniAdmin.render(options);

        // 百度统计代码，只统计指定域名
        miniTongji.render({
            specific: true,
            domains: [
                '99php.cn',
                'layuimini.99php.cn',
                'layuimini-onepage.99php.cn',
            ],
        });

        $('.login-out').on("click", function () {
            layer.confirm('确定退出吗？', function (index) {
                window.location.href = "${basePath}/logout";
            });
        });
    });
</script>
</body>
</html>


```

根据layui的特性，核心页面通过init.json来渲染

```json
{
  "homeInfo": {
    "title": "首页",
    "href": "main"
  },
  "logoInfo": {
    "title": "XX大学",
    "image": "static/images/logo.png",
    "href": ""
  },
  "menuInfo": [
    {
      "title": "系统管理",
      "icon": "fa fa-address-book",
      "href": "",
      "target": "_self",
      "type": "1",
      "child": [
        {
          "title": "专业管理",
          "href": "subject/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        },
        {
          "title": "班级管理",
          "href": "clazz/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        },
        {
          "title": "学生管理",
          "href": "student/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        },
        {
          "title": "老师管理",
          "href": "teacher/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        },
        {
          "title": "课程管理",
          "href": "course/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        },
        {
          "title": "用户管理",
          "href": "user/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        },
        {
          "title": "开课管理",
          "href": "section/list",
          "icon": "fa fa-calendar",
          "target": "_self"
        }
      ]
    }



  ]
}
```



##### 管理员

管理员的亮点是使用了ztree来实现了树状

###### 整合ztree组件

 	首先将导入ztree组件，然后再lay-config.js中进行声明

![1609337509141](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609337509141.png)

![1609337542461](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609337542461.png)



###### 显示ztree

生成ztree数据的controller与显示ztree的页面

```java
 @PostMapping("/tree")
    @ResponseBody
    public  List<Map<String, Object>> tree(){
        //查询专业和班级列表
        List<Subject> subjects= subjectService.query(null);
        List<Clazz> clazzes = clazzService.query(null);

        //将专业和班级列表匹配为对应的json
        List<Map<String, Object>> list = new ArrayList<>();
        //循环前新建list 循环中新建map
        subjects.forEach(subject -> {
            Map<String, Object> subjectMap = new HashMap<>();
            subjectMap.put("id",subject.getId());
            subjectMap.put("pid",0);
            subjectMap.put("name",subject.getSubjectName());

            List<Map<String, Object>> clazzlist = new ArrayList<>();
            clazzes.forEach(clazz -> {
                if (subject.getId() == clazz.getSubjectId().intValue()){
                    Map<String, Object> clazztMap = new HashMap<>();
                    clazztMap.put("id",clazz.getId());
                    clazztMap.put("pid",subject.getId());
                    clazztMap.put("name",clazz.getClazzName());
                    clazzlist.add(clazztMap);
                }
            });
            subjectMap.put("children",clazzlist);
            list.add(subjectMap);
        });
        return list;
    }
```

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
<head>
    <title>专业管理</title>
</head>
<body>
<div class="layuimini-container layuimini-page-anim">
    <div class="layuimini-main">
        <div class="layui-row">
            <div class="layui-col-xs2">
                <ul id="treeDemo" class="ztree"></ul>
            </div>
            <div class="layui-col-xs10">
                <script type="text/html" id="toolbar">
                    <div class="layui-btn-container">
                        <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add">
                            <i class="fa fa-plus"></i>
                            添加
                        </button>
                        <button class="layui-btn layui-btn-sm layui-btn-normal data-delete-btn" lay-event="update">
                            <i class="fa fa-pencil"></i>
                            修改
                        </button>
                        <button class="layui-btn layui-btn-sm layui-btn-danger data-delete-btn" lay-event="delete">
                            <i class="fa fa-remove"></i>
                            删除
                        </button>
                    </div>
                </script>
                <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
            </div>

        </div>

    </div>
</div>
<script>
    layui.use(['form', 'table','ztree'], function () {
        var $ = layui.jquery,
            form = layui.form,
            ztree = layui.ztree,
            table = layui.table;

            var setting = {
                async:{
                    enable:true,
                    type:"post",
                    url:"${basePath}section/tree"
                },
                callback:{
                    onClick:function(event,treeId,treeNode){
                        if(treeNode.parentId !=0){
                            var json = {};
                            json.clazzId = treeNode.id;
                            table.reload('currentTableId', {
                                contentType:'application/json',
                                where: json
                            }, 'data');
                        }
                    }
                }
            };

            ztree.init($("#treeDemo"), setting);

            table.render({
                elem: '#currentTableId',
                url: '${basePath}section/query',
                contentType:'application/json',
                method:"post",
                toolbar: '#toolbar',
                defaultToolbar: ['filter', 'exports', 'print'],
                page: true,
                cols: [[
                    {type: "checkbox", width: 50},
                    {field: 'id', width: 80, title: 'ID'},
                    {field: 'year',  title: '年度'},
                    {field: 'type',  title: '类型'},
                    {field: 'teacherName', title: '老师',templet:'<div>{{d.teacher.teacherName}}</div>'},
                    {field: 'courseName', title: '课程',templet:'<div>{{d.course.courseName}}</div>'},
                    {field: 'remark',  title: '备注'}
                ]],
                skin: 'line'
            });

        // 监听搜索操作
        form.on('submit(search-btn)', function (data) {
            //执行搜索重载
            table.reload('currentTableId', {
                contentType:'application/json',
                where: data.field
            }, 'data');
            return false;
        });
        /**
    * toolbar事件监听
        */
        table.on('toolbar(currentTableFilter)', function (obj) {
            if (obj.event === 'add') {   // 监听添加操作
                var treeObj = ztree.getZTreeObj("treeDemo");
                var selectedNode = treeObj.getSelectedNodes();
                console.log(selectedNode);
                if(selectedNode.length == 0){
                    layer.msg("请选择左侧班级",{time:1000});
                    return;
                }
                var index = layer.open({
                    title: '添加用户',
                    type: 2,
                    shade: 0.2,
                    shadeClose: false,
                    area: ['50%', '50%'],
                    content: '${basePath}section/add?clazzId='+selectedNode[0].id,
                    end:function(){
                        table.reload('currentTableId');
                    }
                });
            } else if (obj.event === 'update') {  // 监听修改操作
                var checkStatus = table.checkStatus('currentTableId');
                var data = checkStatus.data;
                if(data.length !=1){
                    layer.msg("请选择一行数据修改",{time:1000});
                    return;
                }
                var index = layer.open({
                    title: '修改用户',
                    type: 2,
                    shade: 0.2,
                    shadeClose: false,
                    area: ['50%', '50%'],
                    content: '${basePath}section/detail/'+data[0].id,
                    end:function(){
                        table.reload('currentTableId');
                    }
                });
            }else if (obj.event === 'delete') { // 监听删除操作
                var checkStatus = table.checkStatus('currentTableId');
                var data = checkStatus.data;
                console.log(checkStatus);
                if(data.length ==0){
                    layer.msg("请选择行数据删除",{time:1000});
                    return;
                }
                var arr = [];
                for(index in data){
                    arr.push(data[index].id);
                }
                layer.confirm('确认删除数据', function (index) {
                    $.ajax({
                        url:"${basePath}section/delete",
                        type:"POST",
                        dataType:'json',
                        data:"ids="+arr.join(","),
                        success:function(data){
                            layer.msg(data.msg,{time:500},
                                function(){
                                    table.reload("currentTableId");
                                });
                        },
                        error:function(data){
                            console.log(data);
                        }
                    });
                });
            }
        });
    });
</script>
</body>
</html>

```



##### 老师

##### 学生

学生的亮点为，已选课程保持在选课状态

```xml
 layui.use(['form', 'table'], function () {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table;
            table.render({
                elem: '#currentTableId',
                url: '${basePath}section/queryStudentSection',
                contentType:'application/json',
                method:"post",
                toolbar: '#toolbar',
                defaultToolbar: ['filter', 'exports', 'print'],
                page: true,
                cols: [[
                    {type: "checkbox", width: 50},
                    {field: 'year', width: 80, title: '年度'},
                    {field: 'type',  title: '类型'},
                    {field: 'clazzName', title: '所属班级',templet:'<div>{{d.clazz.clazzName}}</div>'},
                    {field: 'courseName', title: '课程',templet:'<div>{{d.course.courseName}}</div>'},
                    {field: 'teacherName', title: '老师',templet:'<div>{{d.teacher.teacherName}}</div>'},
                    {field: 'remark',  title: '备注'}
                ]],
                done: function(res, page, count){
                    for(var index in res.data){
                        if(res.data[index].checked >= 1){
                            res.data[index]["LAY_CHECKED"]='true';
                            var index= res.data[index]['LAY_TABLE_INDEX'];
                            $('tr[data-index=' + index + '] input[type="checkbox"]').prop('checked', true);
                            $('tr[data-index=' + index + '] input[type="checkbox"]').next().addClass('layui-form-checked');
                        }
                    }
                },
                skin: 'line'
            });
```



##### 统计

统计采用了echart模块，layui已经集成了这个模块

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
<head>
    <title>Title</title>
    <style>
        .layui-card-body ul {
            list-style: none;
        }

        .layui-card-body ul li {
            float: left;
            padding: 5px;
        }

        .layui-card-body ul li:hover {
            background-color: #f0f0f0;
        }

        .layui-card-body ul li table {
            width: 150px;
        }

        .layui-card-body ul li table i {
            font-size: 36px;
            color: #1aa094
        }

        .layui-card-body ul li table .number {
            font-size: 24px;
            color: red
        }

        .layui-card-body ul li table .txt {
            color: #888888;
        }
    </style>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15" style="margin-top: 10px;">
        <div class="layui-col-md12">
            <div class="layui-card" style="height: 125px">
                <div class="layui-card-header">系统概览</div>
                <div class="layui-card-body">
                    <ul>
                        <li>
                            <table>
                                <tr>
                                    <td rowspan="2" align="center">
                                        <i class="layui-icon layui-icon-form"></i>
                                    </td>
                                    <td class="number" id="subject">${subjectCount}</td>
                                </tr>
                                <tr>
                                    <td class="txt">专业数量</td>
                                </tr>
                            </table>
                        </li>
                        <li>
                            <table>
                                <tr>
                                    <td rowspan="2" align="center">
                                        <i class="layui-icon layui-icon-carousel"></i>
                                    </td>
                                    <td class="number" id="clazz">${clazzCount}</td>
                                </tr>
                                <tr>
                                    <td class="txt">班级数量</td>
                                </tr>
                            </table>
                        </li>
                        <li>
                            <table>
                                <tr>
                                    <td rowspan="2" align="center">
                                        <i class="layui-icon layui-icon-file"></i>
                                    </td>
                                    <td class="number" id="course">${courseCount}</td>
                                </tr>
                                <tr>
                                    <td class="txt">课程数量</td>
                                </tr>
                            </table>
                        </li>
                        <li>
                            <table>
                                <tr>
                                    <td rowspan="2" align="center">
                                        <i class="layui-icon layui-icon-group"></i>
                                    </td>
                                    <td class="number" id="teacher">${teacherCount}</td>
                                </tr>
                                <tr>
                                    <td class="txt">老师数量</td>
                                </tr>
                            </table>
                        </li>
                        <li>
                            <table>
                                <tr>
                                    <td rowspan="2" align="center">
                                        <i class="layui-icon layui-icon-menu-fill"></i>
                                    </td>
                                    <td class="number" id="section">${sectionCount}</td>
                                </tr>
                                <tr>
                                    <td class="txt">开课数量</td>
                                </tr>
                            </table>
                        </li>
                        <li>
                            <table>
                                <tr>
                                    <td rowspan="2" align="center">
                                        <i class="layui-icon layui-icon-user"></i>
                                    </td>
                                    <td class="number" id="student">${studentCount}</td>
                                </tr>
                                <tr>
                                    <td class="txt">学生数量</td>
                                </tr>
                            </table>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-row layui-col-space15" style="margin-top: 10px;">
        <div class="layui-col-md8">
            <div class="layui-card">
                <div class="layui-card-header">班级学生数量</div>
                <div class="layui-card-body">
                    <div style="height: 300px" id="container">
                        ddd
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-col-md4">
            <div class="layui-card">
                <div class="layui-card-header">功能区</div>
                <div class="layui-card-body">
                    <div style="height: 300px">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-row layui-col-space15">
        <div class="layui-col-md8">
            <div class="layui-card">
                <div class="layui-card-header">课程平均成绩</div>
                <div class="layui-card-body">
                    <div style="height: 300px" id="container2">
                        ddd
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-col-md4">
            <div class="layui-card">
                <div class="layui-card-header">功能区</div>
                <div class="layui-card-body">
                    <div style="height: 300px">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    layui.use(['echarts'], function () {
        var echarts = layui.echarts,$ = layui.jquery;
        //1、统计班级学生数量
        var echartsRecords = echarts.init(document.getElementById("container"));
        option = {
            xAxis: {
                type: 'category',
                data: [
                    <c:forEach items="${clazzList}" var="clazz">
                    '${clazz.name}',
                    </c:forEach>
                ]
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                data: [
                    <c:forEach items="${clazzList}" var="clazz">
                    ${clazz.cnt},
                    </c:forEach>
                ],
                type: 'bar',
                showBackground: true,
                backgroundStyle: {
                    color: 'rgba(220, 220, 220, 0.8)'
                }
            }]
        };
        echartsRecords.setOption(option);


        //2、统计课程平均成绩
        var echartsRecords2 = echarts.init(document.getElementById("container2"));
        option2 = {
            xAxis: {
                type: 'category',
                data: [
                    <c:forEach items="${courseList}" var="course">
                    '${course.courseName}',
                    </c:forEach>
                ]
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                data: [
                    <c:forEach items="${courseList}" var="course">
                    ${course.cnt},
                    </c:forEach>
                ],
                type: 'bar',
                showBackground: true,
                backgroundStyle: {
                    color: 'rgba(220, 220, 220, 0.8)'
                }
            }]
        };
        echartsRecords2.setOption(option2);
        //echarts 窗口缩放自适应
        window.onresize = function(){
            echartsRecords.resize();
            echartsRecords2.resize();
        }


    });
</script>
</body>
</html>

```



### 项目的打包和部署

##### 服务器的环境配置

###### 服务器的购买和连接

 	 购买阿里云的服务器，默认购买时第一次登录需要设置密码，采用公网IP进行登录， 	

###### dock的使用

docker的使用步骤：

- 利用yum命令安装docker
- systemctl start docker //开启docker
- docker pull tomcat //获取镜像
- docker  run    ，同时做好端口映射

##### 项目的打包

利用package命令，将文件打包到项目目录的target文件夹中，打包前，要确认mysql的连接是否准确

##### 项目的部署

1. 将生成的war包导入到服务器中

2. 将war包放到docker开启的tomcat的webapps中

3. 重启tomcat

   ![1609342381246](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1609342381246.png)

### 代码的版本控制

##### git的使用

1. 通过VCS的导航条命令开启git    //此时文件会变红
2. 设置gitignore                               //被忽略的文件变灰
3. commit                                          //红色的文件变黑
4. git-push                                  //将文件上传到github



##### 上传至github

设置github用户时，可以使用token登录，成功率高





